---
title: "cleaning-script"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## package loading

loading in the relevant CRAN packages. 

```{r}
library(tidyverse)
library(ggpubr)
```


## data loading

loading in the US enrollment data from the `parent-dataset` folder

```{r}
as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/enrollment_projections.csv"))
```

performing the necessary cleaning procedures to make the parent dataset suitable for our analyses

in order, we: 

1. omit the initial two rows that correspond to (1) the title of the table and and (2) the numeric column identifiers

2. omit the degree-level percent-female variables 

3. rename the variables for brevity

4. omit the row specifying the variable ID

5. omit the source information and table notes from the tibble

6. renamed the columns dichotomously indicating whether the corresponding bachelor-level enrollment value include degrees classified as master's or doctor's degree in later years

7. changed column values within the the `bach_deg_tot_assoc`, `bach_deg_m_assoc`, and `bach_deg_f_assoc` from `\\2\\` to `1` and `0`, with `1` corresponding to enrollment totals that do incoude degrees classified as master's or doctor's degrees in later years and `0` corresponding to enrollment totals that do not

8. changed columns from character strings to numeric strings 

9. replaced `NA` values with `0` values

10. generated new columns aggregating the number of degrees earned, both as a total and across sexes, between bachelor's, master's, and doctoral programs 

11. generated new columns calculating the proportion of university degrees contributed by bachelor's, master's, and doctoral programs

12. added an identifying column (by year) for joining purposes



```{r}
enrollment_data <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/enrollment_projections.csv",skip=1)) %>%
  filter(!row_number() %in% c(2)) %>%
  select(!c(Associate.s.degrees.3,Bachelor.s.degrees.6,Master.s.degrees.3,Doctor.s.degrees.1..3)) %>%
  rename(acad.year=Year,assoc_deg_tot=Associate.s.degrees,assoc_deg_m=Associate.s.degrees.1,assoc_deg_f=Associate.s.degrees.2,bach_deg_tot=Bachelor.s.degrees,bach_deg_m=Bachelor.s.degrees.2,bach_deg_f=Bachelor.s.degrees.4,mast_deg_tot=Master.s.degrees,mast_deg_m=Master.s.degrees.1,mast_deg_f=Master.s.degrees.2,doct_deg_tot=Doctor.s.degrees.1.,doct_deg_m=Doctor.s.degrees.1..1,doct_deg_f=Doctor.s.degrees.1..2) %>%
  filter(!row_number() %in% c(1,66,67,68,69,70,71)) %>%
  rename(bach_deg_tot_assoc=Bachelor.s.degrees.1,bach_deg_m_assoc=Bachelor.s.degrees.3,bach_deg_f_assoc=Bachelor.s.degrees.5) %>%
  mutate(bach_deg_tot_assoc=replace(bach_deg_tot_assoc, bach_deg_tot_assoc != "\\2\\","0")) %>%
  mutate(bach_deg_tot_assoc=replace(bach_deg_tot_assoc, bach_deg_tot_assoc == "\\2\\","1")) %>%
  mutate(bach_deg_m_assoc=replace(bach_deg_m_assoc, bach_deg_m_assoc != "\\2\\","0")) %>%
  mutate(bach_deg_m_assoc=replace(bach_deg_m_assoc, bach_deg_m_assoc == "\\2\\","1")) %>%
  mutate(bach_deg_f_assoc=replace(bach_deg_f_assoc, bach_deg_f_assoc != "\\2\\","0")) %>%
  mutate(bach_deg_f_assoc=replace(bach_deg_f_assoc, bach_deg_f_assoc == "\\2\\","1")) %>%
  mutate(assoc_deg_tot=as.double(assoc_deg_tot)) %>%
  mutate(assoc_deg_m=as.double(assoc_deg_m)) %>%
  mutate(assoc_deg_f=as.double(assoc_deg_f)) %>%
  mutate(bach_deg_tot=as.double(bach_deg_tot)) %>%
  mutate(bach_deg_tot_assoc=as.double(bach_deg_tot_assoc)) %>%
  mutate(bach_deg_m=as.double(bach_deg_m)) %>%
  mutate(bach_deg_m_assoc=as.double(bach_deg_m_assoc)) %>%
  mutate(bach_deg_f=as.double(bach_deg_f)) %>%
  mutate(bach_deg_f_assoc=as.double(bach_deg_f_assoc)) %>%
  mutate(mast_deg_tot=as.double(mast_deg_tot)) %>%
  mutate(mast_deg_m=as.double(mast_deg_m)) %>%
  mutate(mast_deg_f=as.double(mast_deg_f)) %>%
  mutate(doct_deg_tot=as.double(doct_deg_tot)) %>%
  mutate(doct_deg_m=as.double(doct_deg_m)) %>%
  mutate(doct_deg_f=as.double(doct_deg_f)) %>%
  replace(is.na(.), 0) %>%
  mutate(univ_deg_tot=bach_deg_tot+mast_deg_tot+doct_deg_tot) %>%
  mutate(univ_deg_m=bach_deg_m+mast_deg_m+doct_deg_m) %>%
  mutate(univ_deg_f=bach_deg_f+mast_deg_f+doct_deg_f) %>%
  mutate(perc_bach_tot=bach_deg_tot/univ_deg_tot) %>%
  mutate(perc_mast_tot=mast_deg_tot/univ_deg_tot) %>%
  mutate(perc_doct_tot=doct_deg_tot/univ_deg_tot) %>%
  separate(acad.year,"year_id",sep="-",remove=FALSE)
enrollment_data
```

## preliminary data exploration

looking at the number of people enrolled in university over time

```{r}
ggplot(enrollment_data,aes(x=year_id,y=univ_deg_tot)) +
  geom_col(fill="#69b3a2",color="#e9ecef") + 
  theme(panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))
```

because it's useful to see this as a function of the national population, we take census projections and estimates to highlighting how enrollment changes relative to changes in the population

this helps to illustrate the role of intervening within these contexts and how it is expected to change over time

in taking the census data, which provides projections from 2022 to 2100, we then take the following steps to clean the data in preparation for a join: 

1. omit the initial few rows containing the title of table and nonessential descriptive information

2. identify and select the relevant columns

3. properly align the rows so that each year corresponds to the correct projection

4. multiply the projection by a factor of 1000 to align the units of analysis

5. remove table footnotes 

5. rename the variables so that they are consistent with our naming conventions

```{r}
population_projections <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/population_projections.csv",skip=4)) %>%
  select(Year,Population) %>%
  mutate(population=as.numeric(Population)*1000) %>%
  filter(!row_number() %in% c(1,2,3,3,4,82,83,84,85,86,87,88,89)) %>%
  rename(year_id=Year) %>%
  select(!Population)
population_projections
```
  
  mutate_at(c("Population"),funs(lead),n=2) %>%

now, we use a `left_join` command to add all matching columns from the `population_projections` tibble to the `enrollment_data` tibble:

```{r}
X20242031 <- left_join(enrollment_data,population_projections)
X20242031
```

as we did for the census-provided population projections, we now do the same for the census-provided population estimates. we do this in three parts because of how the national-population-estimate data is provided.

```{r}
population_estimates_20202023 <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/population_estimates_20202023.csv",skip=3)) %>%
  filter(row_number() %in% c(1)) %>%
  select(X,X2020,X2021,X2022,X2023) %>%
  rename("2020"=X2020,"2021"=X2021,"2022"=X2022,"2023"=X2023) %>%
  pivot_longer(!X,names_to="year_id", values_to="population") %>%
  select(!X) %>%
  mutate(population=as.numeric(population))
population_estimates_20202023
```

with the 2020-2023 data now in an appropriate format, we can join these values to `enrollment_data`, as we did for the population projections

```{r}
X20202023 <- left_join(enrollment_data,population_estimates_20202023) 
X20202023
```

```{r}
population_estimates_20102019 <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/population_estimates_20102019.csv",skip=3)) %>%
  filter(row_number() %in% c(1)) %>%
  select(X,X2010,X2011,X2012,X2013,X2014,X2015,X2016,X2017,X2018,X2019) %>%
  rename("2010"=X2010,"2011"=X2011,"2012"=X2012,"2013"=X2013,"2014"=X2014,"2015"=X2015,"2016"=X2016,"2017"=X2017,"2018"=X2018,"2019"=X2019) %>%
  pivot_longer(!X,names_to="year_id", values_to="population") %>%
  select(!X) %>%
  mutate(population=as.numeric(population))
population_estimates_20102019
```

with the 2010-2019 data now in an appropriate format, we can join these values to  `enrollment_data`, as we did for the 2020-2023 estimates

```{r}
X20102019 <- left_join(enrollment_data,population_estimates_20102019) 
X20102019
```

```{r}
population_estimates_19702009 <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/population_estimates_19702018.csv",skip=0)) %>%
  filter(row_number() %in% c(1)) %>%
  select(Country.Name,X1970..YR1970.,X1971..YR1971.,X1972..YR1972.,X1973..YR1973.,X1974..YR1974.,X1975..YR1975.,X1976..YR1976.,X1977..YR1977.,X1978..YR1978.,X1979..YR1979.,X1980..YR1980.,X1981..YR1981.,X1982..YR1982.,X1983..YR1983.,X1984..YR1984.,X1985..YR1985.,X1986..YR1986.,X1987..YR1987.,X1988..YR1988.,X1989..YR1989.,X1990..YR1990.,X1991..YR1991.,X1992..YR1992.,X1993..YR1993.,X1994..YR1994.,X1995..YR1995.,X1996..YR1996.,X1997..YR1997.,X1998..YR1998.,X1999..YR1999.,X2000..YR2000.,X2001..YR2001.,X2002..YR2002.,X2003..YR2003.,X2004..YR2004.,X2005..YR2005.,X2006..YR2006.,X2007..YR2007.,X2008..YR2008.,X2009..YR2009.) %>%
  rename("1970"=X1970..YR1970.,"1971"=X1971..YR1971.,"1972"=X1972..YR1972.,"1973"=X1973..YR1973.,"1974"=X1974..YR1974.,"1975"=X1975..YR1975.,"1976"=X1976..YR1976.,"1977"=X1977..YR1977.,"1978"=X1978..YR1978.,"1979"=X1979..YR1979.,"1980"=X1980..YR1980.,"1981"=X1981..YR1981.,"1982"=X1982..YR1982.,"1983"=X1983..YR1983.,"1984"=X1984..YR1984.,"1985"=X1985..YR1985.,"1986"=X1986..YR1986.,"1987"=X1987..YR1987.,"1988"=X1988..YR1988.,"1989"=X1989..YR1989.,"1990"=X1990..YR1990.,"1991"=X1991..YR1991.,"1992"=X1992..YR1992.,"1993"=X1993..YR1993.,"1994"=X1994..YR1994.,"1995"=X1995..YR1995.,"1996"=X1996..YR1996.,"1997"=X1997..YR1997.,"1998"=X1998..YR1998.,"1999"=X1999..YR1999.,"2000"=X2000..YR2000.,"2001"=X2001..YR2001.,"2002"=X2002..YR2002.,"2003"=X2003..YR2003.,"2004"=X2004..YR2004.,"2005"=X2005..YR2005.,"2006"=X2006..YR2006.,"2007"=X2007..YR2007.,"2008"=X2008..YR2008.,"2009"=X2009..YR2009.) %>%
  pivot_longer(!Country.Name,names_to="year_id", values_to="population") %>%
  select(!Country.Name) %>%
  mutate(population=as.numeric(population))
population_estimates_19702009
```

with the 1970-2009 data now in an appropriate format, we can join these values to `enrollment_data`, as we did for the 2020-2023 estimates

```{r}
X19702009 <- left_join(enrollment_data,population_estimates_19702009) 
X19702009
```

at this stage, we have separately joined the `population` values from each of the relevant data files, and we have input the values such that there are no overlapping year entries, namely to prioritize inputting population estimates over population projections, as the census recommends

```{r}
X19702031 <- bind_rows(population_estimates_19702009,population_estimates_20102019,population_estimates_20202023,population_projections)
X19702031
```

now, we join these values to the original `enrollment_data` and remove rows without population data 

```{r}
cleaned_data <- left_join(enrollment_data,X19702031) %>%
    filter(!row_number() %in% c(1,2,3,4,5,6,7,8,9,10,11))
cleaned_data
```
now, we can generate a new variable calculating the share of the estimated (1979-20-and projected population that is estimated and projected to be enrolled in 

```{r}
cleaned_data <- cleaned_data %>% mutate(prop_pop_univ_deg_tot=univ_deg_tot/population)
cleaned_data
```

```{r}
ggplot(cleaned_data,aes(x=year_id,y=prop_pop_univ_deg_tot)) +
  geom_col(fill="#69b3a2",color="#e9ecef") +
  theme(panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))
```
this demonstrates how it is not just the number of university enrollees that are increasing but so too is the proportion of the US population that is enrolled in university, reinforcing why it is becoming increasingly important to focus efforts on intervening on dietary behaviors within college and university contexts

that said, it is also clear from this chart that the number of university enrollees form a small subset of the national population. it could therefore be important to track, in addition to the proportion of the population expected to be actively enrolled in university during any given year, the proportion of the population that has earned a bachelor degree and the proportion of the university-aged population that is enrolled in university

because the data for the latter is already included in one of the parent datasets, we'll begin with this step. 

to do this, we'll have to take the relevant values from `population_estimates_19702018`

```{r}
school_aged_population_estimates_19702018 <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/population_estimates_19702018.csv",skip=0)) %>%
  filter(row_number() %in% c(2)) %>%
  select(Country.Name,X1970..YR1970.,X1971..YR1971.,X1972..YR1972.,X1973..YR1973.,X1974..YR1974.,X1975..YR1975.,X1976..YR1976.,X1977..YR1977.,X1978..YR1978.,X1979..YR1979.,X1980..YR1980.,X1981..YR1981.,X1982..YR1982.,X1983..YR1983.,X1984..YR1984.,X1985..YR1985.,X1986..YR1986.,X1987..YR1987.,X1988..YR1988.,X1989..YR1989.,X1990..YR1990.,X1991..YR1991.,X1992..YR1992.,X1993..YR1993.,X1994..YR1994.,X1995..YR1995.,X1996..YR1996.,X1997..YR1997.,X1998..YR1998.,X1999..YR1999.,X2000..YR2000.,X2001..YR2001.,X2002..YR2002.,X2003..YR2003.,X2004..YR2004.,X2005..YR2005.,X2006..YR2006.,X2007..YR2007.,X2008..YR2008.,X2009..YR2009.,X2010..YR2010.,X2011..YR2011.,X2012..YR2012.,X2013..YR2013.,X2014..YR2014.,X2015..YR2015.,X2016..YR2016.,X2017..YR2017.,X2018..YR2018.) %>%
  rename("1970"=X1970..YR1970.,"1971"=X1971..YR1971.,"1972"=X1972..YR1972.,"1973"=X1973..YR1973.,"1974"=X1974..YR1974.,"1975"=X1975..YR1975.,"1976"=X1976..YR1976.,"1977"=X1977..YR1977.,"1978"=X1978..YR1978.,"1979"=X1979..YR1979.,"1980"=X1980..YR1980.,"1981"=X1981..YR1981.,"1982"=X1982..YR1982.,"1983"=X1983..YR1983.,"1984"=X1984..YR1984.,"1985"=X1985..YR1985.,"1986"=X1986..YR1986.,"1987"=X1987..YR1987.,"1988"=X1988..YR1988.,"1989"=X1989..YR1989.,"1990"=X1990..YR1990.,"1991"=X1991..YR1991.,"1992"=X1992..YR1992.,"1993"=X1993..YR1993.,"1994"=X1994..YR1994.,"1995"=X1995..YR1995.,"1996"=X1996..YR1996.,"1997"=X1997..YR1997.,"1998"=X1998..YR1998.,"1999"=X1999..YR1999.,"2000"=X2000..YR2000.,"2001"=X2001..YR2001.,"2002"=X2002..YR2002.,"2003"=X2003..YR2003.,"2004"=X2004..YR2004.,"2005"=X2005..YR2005.,"2006"=X2006..YR2006.,"2007"=X2007..YR2007.,"2008"=X2008..YR2008.,"2009"=X2009..YR2009.,"2010"=X2010..YR2010.,"2011"=X2011..YR2011.,"2012"=X2012..YR2012.,"2013"=X2013..YR2013.,"2014"=X2014..YR2014.,"2015"=X2015..YR2015.,"2016"=X2016..YR2016.,"2017"=X2017..YR2017.,"2018"=X2018..YR2018.) %>%
  pivot_longer(!Country.Name,names_to="year_id", values_to="univ_aged_pop") %>%
  select(!Country.Name) %>%
  mutate(univ_aged_pop=as.numeric(univ_aged_pop))
school_aged_population_estimates_19702018
```

now, we can append this column to `cleaned_data`

```{r}
cleaned_data <- left_join(cleaned_data,school_aged_population_estimates_19702018)
cleaned_data
```

```{r}
ggplot(cleaned_data,aes(x=year_id,y=univ_aged_pop)) +
  geom_col(fill="#69b3a2",color="#e9ecef") +
  theme(panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))
```

while it's useful to see how the university-aged population has changed over time, it's more valuable to visualize how the number of enrollees within this population has shifted between 1970 and 2018

```{r}
cleaned_data <- cleaned_data %>% mutate(prop_univ_aged_pop_univ_deg_tot=univ_deg_tot/univ_aged_pop)
cleaned_data
```

```{r}
ggplot(cleaned_data,aes(x=year_id,y=prop_univ_aged_pop_univ_deg_tot)) +
  geom_col(fill="#69b3a2",color="#e9ecef") +
  theme(panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))
```

in addition to showing how the proportion of enrollees within this segment of the population has increased with time (i.e., demonstrating how more individuals within this age range are enrolled in university than before), we also want to see how educational attainment has evolved with time (i.e., the proportion of the population with bachelor degrees or higher)

while this graph shows the share of people who are within a particular age range who are actively attending university in a given year, educational attainment provides a proxy for the amount of people who have received this type of educational experience cumulatively over time.

for this, we will need to load in additional data. more specifically, we will need to retrieve historical time series data from the census tracking educational attainment for individuals (both sexes) aged 25 years and over

as we did before, we'll first need to load this data in and get it into an appropriate format


```{r}
attainment_estimates_19402022 <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/attainment_estimates.csv",skip=5)) %>%
  filter(!row_number() %in% c(1)) %>%
  filter(row_number() %in% c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,63,64,65,66,67)) %>%
  select(X,X1.to.3.years.1,X4.years.or.more) %>%
  rename(year_id=X,attain_onetothree=X1.to.3.years.1,attain_fourormore=X4.years.or.more) %>%
  mutate(attain_onetothree=as.numeric(attain_onetothree*1000)) %>%
  mutate(attain_fourormore=as.numeric(attain_fourormore*1000)) %>%
  mutate(attainment=attain_onetothree+attain_fourormore)
attainment_estimates_19402022
```

```{r}
ggplot(attainment_estimates_19402022,aes(x=year_id,y=attainment)) +
  geom_col(fill="#69b3a2",color="#e9ecef") +
  theme(panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))
```

this is initially useful in demonstrating how the number of people who have been to college have increased over time, but, as before, it does not account for the general increases in the total population

so, for this reason, we have to take in population data for individuals aged 25 and over

```{r}
population25plus_estimates <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/population25plus_estimates.csv",skip=0)) %>%
  filter(row_number() %in% c(3,4,5)) %>%
  select(Country.Name,Series,X1990..YR1990.,X1991..YR1991.,X1992..YR1992.,X1993..YR1993.,X1994..YR1994.,X1995..YR1995.,X1996..YR1996.,X1997..YR1997.,X1998..YR1998.,X1999..YR1999.,X2000..YR2000.,X2001..YR2001.,X2002..YR2002.,X2003..YR2003.,X2004..YR2004.,X2005..YR2005.,X2006..YR2006.,X2007..YR2007.,X2008..YR2008.,X2009..YR2009.,X2010..YR2010.,X2011..YR2011.,X2012..YR2012.,X2013..YR2013.,X2014..YR2014.,X2015..YR2015.) %>%
  mutate(X2013..YR2013.=as.character(X2013..YR2013.)) %>%
  mutate(X2014..YR2014.=as.character(X2014..YR2014.)) %>%
  mutate(X2015..YR2015.=as.character(X2015..YR2015.)) %>%
  rename("1990"=X1990..YR1990.,"1991"=X1991..YR1991.,"1992"=X1992..YR1992.,"1993"=X1993..YR1993.,"1994"=X1994..YR1994.,"1995"=X1995..YR1995.,"1996"=X1996..YR1996.,"1997"=X1997..YR1997.,"1998"=X1998..YR1998.,"1999"=X1999..YR1999.,"2000"=X2000..YR2000.,"2001"=X2001..YR2001.,"2002"=X2002..YR2002.,"2003"=X2003..YR2003.,"2004"=X2004..YR2004.,"2005"=X2005..YR2005.,"2006"=X2006..YR2006.,"2007"=X2007..YR2007.,"2008"=X2008..YR2008.,"2009"=X2009..YR2009.,"2010"=X2010..YR2010.,"2011"=X2011..YR2011.,"2012"=X2012..YR2012.,"2013"=X2013..YR2013.,"2014"=X2014..YR2014.,"2015"=X2015..YR2015.) 
populationtotal_estimates <- population25plus_estimates %>% filter(row_number() %in% c(1)) %>%
  select(-Series) %>%
  pivot_longer(!Country.Name,names_to="year_id", values_to="populationtotal") %>%
  select(!Country.Name) %>%
  mutate(populationtotal=as.numeric(populationtotal))
population1524_estimates <- population25plus_estimates %>% filter(row_number() %in% c(2)) %>%
  select(-Series) %>%
  pivot_longer(!Country.Name,names_to="year_id", values_to="population1524") %>%
  select(!Country.Name) %>%
  mutate(population1524=as.numeric(population1524))
population0014_estimates <- population25plus_estimates %>% filter(row_number() %in% c(2)) %>%
  select(-Series) %>%
  pivot_longer(!Country.Name,names_to="year_id", values_to="population0014") %>%
  select(!Country.Name) %>%
  mutate(population0014=as.numeric(population0014))
population25plus_estimates <- left_join(populationtotal_estimates,population1524_estimates)
population25plus_estimates <- left_join(population25plus_estimates,population0014_estimates) %>%
  mutate(population25plus=populationtotal-population1524-population0014) %>%
  select(year_id,population25plus)
population25plus_estimates 
```

now, with the population of individuals aged 25 and over between 1990 and 2015, we can join this to `attainment_estimates_19402022` to derive the proportion of individuals aged 25 and over who have attended some college 

```{r}
population25plus_attain_estimates <- left_join(attainment_estimates_19402022,population25plus_estimates) 
population25plus_attain_estimates
```
```{r}
cleaned_data <- left_join(cleaned_data,population25plus_attain_estimates) %>%
  mutate(prop_attainment_population25plus=attainment/population25plus) %>%
  mutate(prop_attainment_population=attainment/population)
cleaned_data
```

```{r}
cleaned_data %>% drop_na(prop_attainment_population25plus) %>%
  ggplot(aes(x=year_id,y=prop_attainment_population25plus)) + 
  geom_col(fill="#69b3a2",color="#e9ecef") +
  theme(panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))
```

### MAY ALSO WANT TO EXAMINE HOW COMPOSITION ETHNICALLY IS CHANGING ###

## sustainability implications

now that we've set up a sufficient basis looking at how college and university enrollment has and will continue to change, we need to look at both the health and sustainability implications of shifting the dietary patterns of these two populations (both the attainment and enrollment populations) 

this entails, from the sustainability side, adding in the country-specific per capita estimates across each of the  dietary scenarios, both for 

to do this, we will import CLF's country-specific dietary footprint data, as we did for the university dining impact model

```{r}
dietary_footprint_data <- as_tibble(read.csv("/Users/kenjinchang/github/projected-impact-model/parent-datasets/dietary_footprint_data.csv",skip=0)) %>%
  filter(country=="United States of America") %>%
  select(country,diet,attribute,centile_up,value,centile_down) %>%
  filter(attribute=="kg_co2e_total"|attribute=="kg_co2e_excl_luc"|attribute=="l_blue_green_wf"|attribute=="l_blue_wf_total") %>%
  filter(!diet=="baseline_adjusted"|!diet=="baseline_oecd") %>%
  unite("diet_attribute",diet:attribute, remove=TRUE) %>%
  select(!country)
dietary_footprint_data
```

multiply these factors by enrollment estimates and pop projections (univ_deg_tot)

 %>%
  select(diet_attribute,value) %>%
  pivot_wider(names_from=diet_attribute,values_from=value)


with each of these annual per capita estimates, we can now multiply the total number of individuals enrolled in ISCED 6-8 programs by the corresponding sustainability indicators
 
we specifically want to derive each of the indicators that were selected while also isolating the indicators for green water (by subtracting the total water footprint from the total blue water footprint) and the land-use-change-attributable emissions (by subtracting the total carbon emissions from the luc-excluding carbon emissions)

```{r}
cleaned_data <- cleaned_data %>%
  mutate(univ_baseline_kg_co2e_total=univ_deg_tot*2058.1945) %>%
  mutate(univ_baseline_kg_co2e_total_cu=univ_deg_tot*(2058.1945+156.7059)) %>%
  mutate(univ_baseline_kg_co2e_total_cd=univ_deg_tot*(2058.1945-98.00016)) %>%
  mutate(univ_baseline_kg_co2e_excl_luc=univ_deg_tot*2037.7487) %>%
  mutate(univ_baseline_kg_co2e_excl_luc_cu=univ_deg_tot*(2037.7487+156.7059)) %>%
  mutate(univ_baseline_kg_co2e_excl_luc_cd=univ_deg_tot*(2037.7487-98.00016)) %>%
  mutate(univ_baseline_l_blue_green_wf=univ_deg_tot*1237262.3770) %>%
  mutate(univ_baseline_l_blue_green_wf_cu=univ_deg_tot*(1237262.3770+15912.7882)) %>%
  mutate(univ_baseline_l_blue_green_wf_cd=univ_deg_tot*(1237262.3770-7859.23827)) %>%
  mutate(univ_baseline_l_blue_wf_total=univ_deg_tot*144460.4314) %>%
  mutate(univ_baseline_l_blue_wf_total_cu=univ_deg_tot*(144460.4314+14749.9045)) %>%
  mutate(univ_baseline_l_blue_wf_total_cd=univ_deg_tot*(144460.4314-6282.85071)) %>% 
  mutate(univ_meatless_day_kg_co2e_total=univ_deg_tot*1619.7904) %>%
  mutate(univ_meatless_day_kg_co2e_total_cu=univ_deg_tot*(1619.7904+121.6201)) %>%
  mutate(univ_meatless_day_kg_co2e_total_cd=univ_deg_tot*(1619.7904-74.67129)) %>%
  mutate(univ_meatless_day_kg_co2e_excl_luc=univ_deg_tot*1605.2594) %>%
  mutate(univ_meatless_day_kg_co2e_excl_luc_cu=univ_deg_tot*(1605.2594+121.6201)) %>%
  mutate(univ_meatless_day_kg_co2e_excl_luc_cd=univ_deg_tot*(1605.2594-74.67129)) %>%
  mutate(univ_meatless_day_l_blue_green_wf=univ_deg_tot*957985.9418) %>%
  mutate(univ_meatless_day_l_blue_green_wf_cu=univ_deg_tot*(957985.9418+12300.9881)) %>%
  mutate(univ_meatless_day_l_blue_green_wf_cd=univ_deg_tot*(957985.9418-6075.39014)) %>%
  mutate(univ_meatless_day_l_blue_wf_total=univ_deg_tot*112868.4321) %>%
  mutate(univ_meatless_day_l_blue_wf_total_cu=univ_deg_tot*(112868.4321+11402.0496)) %>%
  mutate(univ_meatless_day_l_blue_wf_total_cd=univ_deg_tot*(112868.4321-4856.80265)) %>%
  mutate(univ_low_red_meat_kg_co2e_total=univ_deg_tot*1457.3872) %>%
  mutate(univ_low_red_meat_kg_co2e_total_cu=univ_deg_tot*(1457.3872+127.4111)) %>%
  mutate(univ_low_red_meat_kg_co2e_total_cd=univ_deg_tot*(1457.3872-70.66082)) %>%
  mutate(univ_low_red_meat_kg_co2e_excl_luc=univ_deg_tot*1443.7257) %>%
  mutate(univ_low_red_meat_kg_co2e_excl_luc_cu=univ_deg_tot*(1443.7257+127.4111)) %>%
  mutate(univ_low_red_meat_kg_co2e_excl_luc_cd=univ_deg_tot*(1443.7257-70.66082)) %>%
  mutate(univ_low_red_meat_l_blue_green_wf=univ_deg_tot*1005111.5717) %>%
  mutate(univ_low_red_meat_l_blue_green_wf_cu=univ_deg_tot*(1005111.5717+12556.9708)) %>%
  mutate(univ_low_red_meat_l_blue_green_wf_cd=univ_deg_tot*(1005111.5717-6201.81859)) %>%
  mutate(univ_low_red_meat_l_blue_wf_total=univ_deg_tot*117935.0037) %>%
  mutate(univ_low_red_meat_l_blue_wf_total_cu=univ_deg_tot*(117935.0037+11639.3255)) %>%
  mutate(univ_low_red_meat_l_blue_wf_total_cd=univ_deg_tot*(117935.0037-4957.87238)) %>%
  mutate(univ_no_dairy_kg_co2e_total=univ_deg_tot*1300.5424) %>%
  mutate(univ_no_dairy_kg_co2e_total_cu=univ_deg_tot*(1300.5424+140.3943)) %>%
  mutate(univ_no_dairy_kg_co2e_total_cd=univ_deg_tot*(1300.5424-78.14317)) %>%
  mutate(univ_no_dairy_kg_co2e_excl_luc=univ_deg_tot*1285.1943) %>%
  mutate(univ_no_dairy_kg_co2e_excl_luc_cu=univ_deg_tot*(1443.7257+140.3943)) %>%
  mutate(univ_no_dairy_kg_co2e_excl_luc_cd=univ_deg_tot*(1443.7257-78.14317)) %>%
  mutate(univ_no_dairy_l_blue_green_wf=univ_deg_tot*986698.7721) %>%
  mutate(univ_no_dairy_l_blue_green_wf_cu=univ_deg_tot*(986698.7721+14953.5181)) %>%
  mutate(univ_no_dairy_l_blue_green_wf_cd=univ_deg_tot*(986698.7721-7385.46003)) %>%
  mutate(univ_no_dairy_l_blue_wf_total=univ_deg_tot*124942.7917) %>%
  mutate(univ_no_dairy_l_blue_wf_total_cu=univ_deg_tot*(124942.7917+13860.7365)) %>%
  mutate(univ_no_dairy_l_blue_wf_total_cd=univ_deg_tot*(124942.7917-5904.10180)) %>%
  mutate(univ_no_red_meat_kg_co2e_total=univ_deg_tot*857.9898) %>%
  mutate(univ_no_red_meat_kg_co2e_total_cu=univ_deg_tot*(857.9898+131.7100)) %>%
  mutate(univ_no_red_meat_kg_co2e_total_cd=univ_deg_tot*(857.9898-73.16635)) %>%
  mutate(univ_no_red_meat_kg_co2e_excl_luc=univ_deg_tot*855.4446) %>%
  mutate(univ_no_red_meat_kg_co2e_excl_luc_cu=univ_deg_tot*(855.4446+131.7100)) %>%
  mutate(univ_no_red_meat_kg_co2e_excl_luc_cd=univ_deg_tot*(855.4446-73.16635)) %>%
  mutate(univ_no_red_meat_l_blue_green_wf=univ_deg_tot*757963.0300) %>%
  mutate(univ_no_red_meat_l_blue_green_wf_cu=univ_deg_tot*(757963.0300+15397.1066)) %>%
  mutate(univ_no_red_meat_l_blue_green_wf_cd=univ_deg_tot*(757963.0300-7604.54596)) %>%
  mutate(univ_no_red_meat_l_blue_wf_total=univ_deg_tot*109780.3801) %>%
  mutate(univ_no_red_meat_l_blue_wf_total_cu=univ_deg_tot*(109780.3801+14271.9082)) %>%
  mutate(univ_no_red_meat_l_blue_wf_total_cd=univ_deg_tot*(109780.3801-6079.24399)) %>%
  mutate(univ_pescatarian_kg_co2e_total=univ_deg_tot*876.6985) %>%
  mutate(univ_pescatarian_kg_co2e_total_cu=univ_deg_tot*(876.6985+191.1300)) %>%
  mutate(univ_pescatarian_kg_co2e_total_cd=univ_deg_tot*(876.6985-105.80171)) %>%
  mutate(univ_pescatarian_kg_co2e_excl_luc=univ_deg_tot*874.8201) %>%
  mutate(univ_pescatarian_kg_co2e_excl_luc_cu=univ_deg_tot*(874.8201+191.1300)) %>%
  mutate(univ_pescatarian_kg_co2e_excl_luc_cd=univ_deg_tot*(874.8201-105.80171)) %>%
  mutate(univ_pescatarian_l_blue_green_wf=univ_deg_tot*755752.5469) %>%
  mutate(univ_pescatarian_l_blue_green_wf_cu=univ_deg_tot*(755752.5469+51785.3751)) %>%
  mutate(univ_pescatarian_l_blue_green_wf_cd=univ_deg_tot*(755752.5469-25576.51091)) %>%
  mutate(univ_pescatarian_l_blue_wf_total=univ_deg_tot*154470.6091) %>%
  mutate(univ_pescatarian_l_blue_wf_total_cu=univ_deg_tot*(154470.6091+48000.9743)) %>%
  mutate(univ_pescatarian_l_blue_wf_total_cd=univ_deg_tot*(154470.6091-20446.43439)) %>%
  mutate(univ_vegetarian_kg_co2e_total=univ_deg_tot*1193.9316) %>%
  mutate(univ_vegetarian_kg_co2e_total_cu=univ_deg_tot*(1193.9316+114.4507)) %>%
  mutate(univ_vegetarian_kg_co2e_total_cd=univ_deg_tot*(1193.9316-61.44851)) %>%
  mutate(univ_vegetarian_kg_co2e_excl_luc=univ_deg_tot*1190.4554) %>%
  mutate(univ_vegetarian_kg_co2e_excl_luc_cu=univ_deg_tot*(1190.4554+114.4507)) %>%
  mutate(univ_vegetarian_kg_co2e_excl_luc_cd=univ_deg_tot*(1190.4554-61.44851)) %>%
  mutate(univ_vegetarian_l_blue_green_wf=univ_deg_tot*759347.4136) %>% 
  mutate(univ_vegetarian_l_blue_green_wf_cu=univ_deg_tot*(759347.4136+0.0000)) %>%
  mutate(univ_vegetarian_l_blue_green_wf_cd=univ_deg_tot*(759347.4136-0.0000)) %>%
  mutate(univ_vegetarian_l_blue_wf_total=univ_deg_tot*90961.9731) %>%
  mutate(univ_vegetarian_l_blue_wf_total_cu=univ_deg_tot*(90961.9731+0.0000)) %>%
  mutate(univ_vegetarian_l_blue_wf_total_cd=univ_deg_tot*(90961.9731-0.0000)) %>%
  mutate(univ_23vegan_kg_co2e_total=univ_deg_tot*740.5162) %>%
  mutate(univ_23vegan_kg_co2e_total_cu=univ_deg_tot*(740.5162+138.4838)) %>%
  mutate(univ_23vegan_kg_co2e_total_cd=univ_deg_tot*(740.5162-78.89973)) %>%
  mutate(univ_23vegankg_co2e_excl_luc=univ_deg_tot*734.1675) %>%
  mutate(univ_23vegan_kg_co2e_excl_luc_cu=univ_deg_tot*(734.1675+138.4838)) %>%
  mutate(univ_23vegan_kg_co2e_excl_luc_cd=univ_deg_tot*(734.1675-78.89973)) %>%
  mutate(univ_23vegan_l_blue_green_wf=univ_deg_tot*743296.7674) %>% 
  mutate(univ_23vegan_l_blue_green_wf_cu=univ_deg_tot*(743296.7674+4783.7176)) %>%
  mutate(univ_23vegan_l_blue_green_wf_cd=univ_deg_tot*(743296.7674-2362.65172)) %>%
  mutate(univ_23vegan_l_blue_wf_total=univ_deg_tot*103695.9055) %>%
  mutate(univ_23vegan_l_blue_wf_total_cu=univ_deg_tot*(103695.9055+4434.1304)) %>%
  mutate(univ_23vegan_l_blue_wf_total_cd=univ_deg_tot*(103695.9055-1888.75659	)) %>%
  mutate(univ_vegan_kg_co2e_total=univ_deg_tot*265.3908) %>%
  mutate(univ_vegan_kg_co2e_total_cu=univ_deg_tot*(265.3908+146.3228)) %>%
  mutate(univ_vegan_kg_co2e_total_cd=univ_deg_tot*(265.3908-79.91791)) %>%
  mutate(univ_vegan_kg_co2e_excl_luc=univ_deg_tot*264.0546) %>%
  mutate(univ_vegan_kg_co2e_excl_luc_cu=univ_deg_tot*(264.0546+146.3228)) %>%
  mutate(univ_vegan_kg_co2e_excl_luc_cd=univ_deg_tot*(264.0546-79.91791)) %>%
  mutate(univ_vegan_l_blue_green_wf=univ_deg_tot*619398.9695) %>% 
  mutate(univ_vegan_l_blue_green_wf_cu=univ_deg_tot*(619398.9695+0.0000)) %>%
  mutate(univ_vegan_l_blue_green_wf_cd=univ_deg_tot*(619398.9695-0.0000)) %>%
  mutate(univ_vegan_l_blue_wf_total=univ_deg_tot*97284.1040) %>%
  mutate(univ_vegan_l_blue_wf_total_cu=univ_deg_tot*(97284.1040+0.0000)) %>%
  mutate(univ_vegan_l_blue_wf_total_cd=univ_deg_tot*(97284.1040-0.0000)) %>%
  mutate(univ_baseline_kg_co2e_luc=univ_baseline_kg_co2e_total-univ_baseline_kg_co2e_excl_luc) %>%
  mutate(univ_meatless_day_kg_co2e_luc=univ_meatless_day_kg_co2e_total-univ_meatless_day_kg_co2e_excl_luc) %>%
  mutate(univ_low_red_meat_kg_co2e_luc=univ_low_red_meat_kg_co2e_total-univ_low_red_meat_kg_co2e_excl_luc) %>%
  mutate(univ_no_dairy_kg_co2e_luc=univ_no_dairy_kg_co2e_total-univ_no_dairy_kg_co2e_excl_luc) %>%
  mutate(univ_no_red_meat_kg_co2e_luc=univ_no_red_meat_kg_co2e_total-univ_no_red_meat_kg_co2e_excl_luc) %>%
  mutate(univ_pescatarian_kg_co2e_luc=univ_pescatarian_kg_co2e_total-univ_pescatarian_kg_co2e_excl_luc) %>%
  mutate(univ_vegetarian_kg_co2e_luc=univ_vegetarian_kg_co2e_total-univ_vegetarian_kg_co2e_excl_luc) %>%
  mutate(univ_23vegan_kg_co2e_luc=univ_23vegan_kg_co2e_total-univ_23vegankg_co2e_excl_luc) %>%
  mutate(univ_vegan_kg_co2e_luc=univ_vegan_kg_co2e_total-univ_vegan_kg_co2e_excl_luc) 
cleaned_data
```

still  ^ ^ ^ ^ ^ need to introduce similar functions isolating green water footprints 

mutate to calculate reductions in favor of scenario-specific totals

```{r}
cleaned_data %>%
  select(year_id,univ_baseline_kg_co2e_luc,univ_baseline_kg_co2e_excl_luc,univ_meatless_day_kg_co2e_luc,univ_meatless_day_kg_co2e_excl_luc,univ_low_red_meat_kg_co2e_luc,univ_low_red_meat_kg_co2e_excl_luc,univ_no_dairy_kg_co2e_luc,univ_no_dairy_kg_co2e_excl_luc,univ_no_red_meat_kg_co2e_luc,univ_no_red_meat_kg_co2e_excl_luc,univ_pescatarian_kg_co2e_luc,univ_pescatarian_kg_co2e_excl_luc,univ_vegetarian_kg_co2e_luc,univ_vegetarian_kg_co2e_excl_luc,univ_23vegan_kg_co2e_luc,univ_23vegankg_co2e_excl_luc,univ_vegan_kg_co2e_luc,univ_vegan_kg_co2e_excl_luc) %>%
  pivot_longer(!year_id,names_to="indicator",values_to="value") %>%
  ggplot(aes(x=year_id,y=value,fill=indicator)) +
  geom_col(position="stack") + 
  scale_fill_viridis_d(option="F") + 
  theme(legend.position="none",panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))
```

 
```{r}
cleaned_data %>%
  select(year_id,univ_baseline_kg_co2e_luc,univ_baseline_kg_co2e_excl_luc,univ_meatless_day_kg_co2e_luc,univ_meatless_day_kg_co2e_excl_luc,univ_low_red_meat_kg_co2e_luc,univ_low_red_meat_kg_co2e_excl_luc,univ_no_dairy_kg_co2e_luc,univ_no_dairy_kg_co2e_excl_luc,univ_no_red_meat_kg_co2e_luc,univ_no_red_meat_kg_co2e_excl_luc,univ_pescatarian_kg_co2e_luc,univ_pescatarian_kg_co2e_excl_luc,univ_vegetarian_kg_co2e_luc,univ_vegetarian_kg_co2e_excl_luc,univ_23vegan_kg_co2e_luc,univ_23vegankg_co2e_excl_luc,univ_vegan_kg_co2e_luc,univ_vegan_kg_co2e_excl_luc) %>%
  pivot_longer(!year_id,names_to="indicator",values_to="value") %>%
  ggplot(aes(x=year_id,y=value,fill=indicator)) +
  geom_col(position="stack") + 
  scale_fill_viridis_d(option="F") + 
  theme(legend.position="none",panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0)) +
   facet_wrap(~indicator)
```
now, we genearte variables documenting both the decrease (by subtracting the scenario-based value from the baseline value) and percent decrease (by subtracting the scenario-based value from the baseline value and dividing that difference by the baseline value) in the value of the corresponding indicator from baseline across scenarios 

```{r}
cleaned_data <- cleaned_data %>%
  mutate(univ_meatless_day_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_meatless_day_kg_co2e_total) %>%
  mutate(univ_meatless_day_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_meatless_day_kg_co2e_total)/univ_baseline_kg_co2e_total) %>%
  mutate(univ_low_red_meat_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_low_red_meat_kg_co2e_total) %>%
  mutate(univ_low_red_meat_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_low_red_meat_kg_co2e_total)/univ_baseline_kg_co2e_total) %>%
  mutate(univ_no_dairy_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_no_dairy_kg_co2e_total) %>%
  mutate(univ_no_dairy_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_no_dairy_kg_co2e_total)/univ_baseline_kg_co2e_total) %>%
  mutate(univ_no_red_meat_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_no_red_meat_kg_co2e_total) %>%
  mutate(univ_no_red_meat_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_no_red_meat_kg_co2e_total)/univ_baseline_kg_co2e_total) %>%
  mutate(univ_pescatarian_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_pescatarian_kg_co2e_total) %>%
  mutate(univ_pescatarian_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_pescatarian_kg_co2e_total)/univ_baseline_kg_co2e_total) %>%
  mutate(univ_vegetarian_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_vegetarian_kg_co2e_total) %>%
  mutate(univ_vegetarian_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_vegetarian_kg_co2e_total)/univ_baseline_kg_co2e_total) %>%
  mutate(univ_23vegan_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_23vegan_kg_co2e_total) %>%
  mutate(univ_23vegan_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_23vegan_kg_co2e_total)/univ_baseline_kg_co2e_total) %>%
  mutate(univ_vegan_kg_co2e_total_reduct_from_baseline=univ_baseline_kg_co2e_total-univ_vegan_kg_co2e_total) %>%
  mutate(univ_vegan_kg_co2e_total_perc_reduct_from_baseline=(univ_baseline_kg_co2e_total-univ_vegan_kg_co2e_total)/univ_baseline_kg_co2e_total) 
cleaned_data
```
 
 perc reduct first
 
```{r}
cleaned_data %>%
  select(year_id,univ_meatless_day_kg_co2e_total_reduct_from_baseline,univ_meatless_day_kg_co2e_total_perc_reduct_from_baseline,univ_low_red_meat_kg_co2e_total_reduct_from_baseline,univ_low_red_meat_kg_co2e_total_perc_reduct_from_baseline,univ_no_dairy_kg_co2e_total_reduct_from_baseline,univ_no_dairy_kg_co2e_total_perc_reduct_from_baseline,univ_no_red_meat_kg_co2e_total_reduct_from_baseline,univ_no_red_meat_kg_co2e_total_perc_reduct_from_baseline,univ_pescatarian_kg_co2e_total_reduct_from_baseline,univ_pescatarian_kg_co2e_total_perc_reduct_from_baseline,univ_vegetarian_kg_co2e_total_reduct_from_baseline,univ_vegetarian_kg_co2e_total_perc_reduct_from_baseline,univ_23vegan_kg_co2e_total_reduct_from_baseline,univ_23vegan_kg_co2e_total_perc_reduct_from_baseline,univ_vegan_kg_co2e_total_reduct_from_baseline,univ_vegan_kg_co2e_total_perc_reduct_from_baseline) %>%
  pivot_longer(!year_id,names_to="indicator",values_to="value") 
```

```{r}
cleaned_data %>%
  select(year_id,univ_meatless_day_kg_co2e_total_perc_reduct_from_baseline,univ_low_red_meat_kg_co2e_total_perc_reduct_from_baseline,univ_no_dairy_kg_co2e_total_perc_reduct_from_baseline,univ_no_red_meat_kg_co2e_total_perc_reduct_from_baseline,univ_pescatarian_kg_co2e_total_perc_reduct_from_baseline,univ_vegetarian_kg_co2e_total_perc_reduct_from_baseline,univ_23vegan_kg_co2e_total_perc_reduct_from_baseline,univ_vegan_kg_co2e_total_perc_reduct_from_baseline) %>%
  pivot_longer(!year_id,names_to="indicator",values_to="value") %>%
  ggplot(aes(x=year_id,y=value,fill=indicator)) +
  geom_col(position="stack") + 
  scale_fill_viridis_d(option="F") + 
  theme(legend.position="none",panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0)) 
```

```{r}
cleaned_data %>%
  select(year_id,univ_meatless_day_kg_co2e_total_reduct_from_baseline,univ_low_red_meat_kg_co2e_total_reduct_from_baseline,univ_no_dairy_kg_co2e_total_reduct_from_baseline,univ_no_red_meat_kg_co2e_total_reduct_from_baseline,univ_pescatarian_kg_co2e_total_reduct_from_baseline,univ_vegetarian_kg_co2e_total_reduct_from_baseline,univ_23vegan_kg_co2e_total_reduct_from_baseline,univ_vegan_kg_co2e_total_reduct_from_baseline) %>%
  pivot_longer(!year_id,names_to="indicator",values_to="value") %>%
  ggplot(aes(x=year_id,y=value,fill=indicator)) +
  geom_col(position="stack") + 
  scale_fill_viridis_d(option="F") + 
  theme(legend.position="none",panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0)) 
```

```{r}
cleaned_data %>%
  select(year_id,univ_meatless_day_kg_co2e_total_reduct_from_baseline,univ_low_red_meat_kg_co2e_total_reduct_from_baseline,univ_no_dairy_kg_co2e_total_reduct_from_baseline,univ_no_red_meat_kg_co2e_total_reduct_from_baseline,univ_pescatarian_kg_co2e_total_reduct_from_baseline,univ_vegetarian_kg_co2e_total_reduct_from_baseline,univ_23vegan_kg_co2e_total_reduct_from_baseline,univ_vegan_kg_co2e_total_reduct_from_baseline) %>%
  pivot_longer(!year_id,names_to="indicator",values_to="value") %>%
  ggplot(aes(x=year_id,y=value,fill=indicator)) +
  geom_col(position="stack") + 
  scale_fill_viridis_d(option="F") + 
  theme(legend.position="none",panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0)) +
  facet_wrap(~indicator)
```






cleaned_data %>%
  select(year_id,univ_baseline_kg_co2e_luc,univ_baseline_kg_co2e_excl_luc,univ_meatless_day_kg_co2e_luc,univ_meatless_day_kg_co2e_excl_luc,univ_low_red_meat_kg_co2e_luc,univ_low_red_meat_kg_co2e_excl_luc,univ_no_dairy_kg_co2e_luc,univ_no_dairy_kg_co2e_excl_luc,univ_no_red_meat_kg_co2e_luc,univ_no_red_meat_kg_co2e_excl_luc,univ_pescatarian_kg_co2e_luc,univ_pescatarian_kg_co2e_excl_luc,univ_vegetarian_kg_co2e_luc,univ_vegetarian_kg_co2e_excl_luc,univ_23vegan_kg_co2e_luc,univ_23vegankg_co2e_excl_luc,univ_vegan_kg_co2e_luc,univ_vegan_kg_co2e_excl_luc) %>%
  pivot_longer(!year_id,names_to="indicator",values_to="value") %>%
  ggplot(aes(x=year_id,y=value,fill=indicator)) +
  geom_col(position="stack") + 
  scale_fill_viridis_d(option="F") + 
  theme(legend.position="none",panel.grid.minor=element_blank(),panel.border=element_rect(color="black",fill="transparent"),panel.background=element_rect(fill="transparent"),axis.text.x=element_text(angle=90,vjust=0,hjust=0))

